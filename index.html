<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>electron-shadcn Template</title>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />
    <style>
      html, body { height: 100%; margin: 0; padding: 0; }
      /* Hide everything until ready */
      body { opacity: 0; transition: opacity 0.2s; }
      body.app-ready { opacity: 1; }
      /* Prevent any flash of content */
      #app { display: none; }
      body.app-ready #app { display: block; }
    </style>
    <script>
      (function(){
        try {
          var root = document.documentElement;
          var savedUserData = localStorage.getItem('currentUser');
          var user = savedUserData ? JSON.parse(savedUserData) : null;
          var themePref = null;
          if (user && user.id) themePref = localStorage.getItem('user_theme_' + user.id);
          if (!themePref) themePref = localStorage.getItem('theme');
          var prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
          if (themePref === 'dark' || (themePref === 'system' && prefersDark)) {
            root.classList.add('dark');
          } else if (themePref === 'light') {
            root.classList.remove('dark');
          } else {
            if (prefersDark) root.classList.add('dark'); else root.classList.remove('dark');
          }
          function hexToHsl(hex){
            var r = parseInt(hex.slice(1,3),16)/255;
            var g = parseInt(hex.slice(3,5),16)/255;
            var b = parseInt(hex.slice(5,7),16)/255;
            var max = Math.max(r,g,b), min = Math.min(r,g,b);
            var h = 0, s = 0, l = (max+min)/2;
            if (max !== min) {
              var d = max - min;
              s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
              switch (max) {
                case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                case g: h = (b - r) / d + 2; break;
                case b: h = (r - g) / d + 4; break;
              }
              h /= 6;
            }
            return Math.round(h*360)+" "+Math.round(s*100)+"% "+Math.round(l*100)+"%";
          }
          if (!root.classList.contains('dark') && user) {
            if (user.primary_theme_color) root.style.setProperty('--primary', hexToHsl(user.primary_theme_color));
            if (user.secondary_theme_color) root.style.setProperty('--secondary', hexToHsl(user.secondary_theme_color));
          }
        } catch (e) {}
      })();
    </script>
    <link rel="stylesheet" href="/src/styles/global.css" />
  </head>
  <body>
    <div id="app" />
    <script type="module" src="/src/renderer.ts"></script>
  </body>
</html>
